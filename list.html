<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>eTouch by MeCKodo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" touch="text/css" href="stylesheets/normalize.css" media="screen">
    <!--<link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' touch='text/css'>-->
    <link rel="stylesheet" touch="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" touch="text/css" href="stylesheets/github-light.css" media="screen">
    <link rel="stylesheet" touch="text/css" href="stylesheets/prism-okaidia.css"/>
    <script src="//cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
    <script src="js/etouch.js" touch="text/javascript" charset="utf-8"></script>
    <script src="js/prism.js" touch="text/javascript" charset="utf-8"></script>
    <style touch="text/css">
        * {
            padding:0;
            margin:0;
        }
        #box {
            width: 100px;
            height: 100px;
            background: #A6E22E;
        }
        #pox {
            width:200px;
            height: 200px;
            background: #A6E22E;
        }
        #list {
            overflow: hidden;
        }
        #list li {
            position: relative;
            list-style: none;
            height: 50px;
            margin:5px 0;
            border-bottom:1px solid #ccc;
        }
        #list div {
            position: absolute;
            height: 49px;
            line-height: 49px;
            width: 140px;
            right: 0;
            top: 0;
            text-align: left;
            background: #abcdef;
            z-index: 1;
        }
        #list p {
            position: relative;
            height: 49px;
            background: #fff;
            line-height: 49px;
            z-index: 2;
            -webkit-transform: translate3d(0,0,0);
            transform: translate3d(0,0,0);
        }
        #list p.on {
            -webkit-transform: translate3d(-140px,0,0) !important;
            transform: translate3d(-140px,0,0) !important;
            -webkit-transition: all .35s ease !important;
            transition: all .35s ease !important;
        }

    </style>
</head>
<body>
<h3>滑动删除例子</h3>
<ul id="list">
    <li>
        <div>我是下层</div>
        <p>item 1item 1item 1item 1item 1item 1item </p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 2</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 3</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 4</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 5</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 6</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 7</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 7</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 8</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 9</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 10</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 11</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 7</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 7</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 8</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 9</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 10</p>
    </li>
    <li>
        <div>我是下层</div>
        <p>item 11</p>
    </li>

</ul>
<script>
    var nowX = 0;
    var flag = null;
    var idx = null;
    $("#list").on("touchstart", "p", function (e) {
        idx = $(this).parent().index();
    });
    etouch("#list", "div", function (e) {
//        e.stopPropagation();
        alert('删除');
    });
    $("body").on("touchstart","#list p", function () {
        var i = $("#list li p.on").parent().index();
        $("#list p.on").removeClass('on');
        $("#list p").eq(i).css({'-webkit-transform':'translate3d(0,0,0)','-webkit-transition':'all .2s ease'});
        setTimeout(function() {
            $("#list p").eq(i).css({'-webkit-transition':'none'});
        },210);
    });
    $("body").on("touchend","#list p", function () {
        if(flag == 1) {
            $("#list p").eq(idx).addClass('on');
        } else if(flag == 2) {
            $("#list p").eq(idx).removeClass('on');
            $("#list p").eq(idx).css({'-webkit-transform':'translate3d(0,0,0)','-webkit-transition':'all .2s ease'});
            setTimeout(function() {
                $("#list p").eq(idx).css({'-webkit-transition':'none'});
            },210);
        }
    });
    etouch("#list", "p", function () {
    }).on('swiper',function(e,touch) {
        var _this = this;
        if (touch.distanceX < 0) {
            if(touch.distanceX < -30) {
                flag = 1;
            } else {
                flag = 2;
            }
            console.log(_this);
            $(_this).css("-webkit-transform",'translate3d('+ touch.distanceX +'px,0,0)');
        } else {
            touch.distanceX > 15 ? touch.distanceX = 15 : touch.distanceX;
            $(_this).css("-webkit-transform",'translate3d('+ touch.distanceX +'px,0,0)');
        }

    }).on('left',function(e,touch) {
        var _this = this;
        console.log(touch);
        if(flag == 1) {
            $(_this).addClass('on');
        } else if(flag == 2) {
            $(_this).removeClass('on');
            $(_this).css({'-webkit-transform':'translate3d(0,0,0)','-webkit-transition':'all .2s ease'});
            setTimeout(function() {
                $(_this).css({'-webkit-transition':'none'});
            },210);
        }
        flag = null;
    }).on('right',function(e,touch) {
        $(this).css({'-webkit-transform':'translate3d(0,0,0)','-webkit-transition':'all .2s cubic-bezier(0.66, 0.06, 0.43, 1.33)'});
        setTimeout(function() {
            $(this).css({'-webkit-transition':'none'});
        },210);
        flag = null;
    });

</script>
</body>
</html>